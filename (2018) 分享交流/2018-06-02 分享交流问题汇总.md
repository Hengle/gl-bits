
2018-06-02 分享交流问题汇总

1. U3D工作流程方向 
    - 工程大了后，打开慢、更新慢如何解决 
        + 一个字：拆。
            * 评估标准只有一条：**版本库应当仅包含跟版本有关的代码和资源**
            * 所有的美术素材拆分入独立资源库，使用 svn/perforce 管理 (由美术组自行维护)
            * 所有策划设计档(doc) / 数值档 (excel) 独立管理 (由策划组自行维护)
            * 所有第三方插件使用最小包，源 unitypackage 整散包独立管理 (由程序组自行维护)
            * 所有版本无关的资源和代码：发布构建脚本/自动化测试脚本/Unity外的工具集/平台相关工具集 (由测试组自行维护)
        + 以上这些仅为参考思路，不必全做 (酌情做)
        + 所有分库需要镜像到备份仓库用于项目核心资产存档
    - 如何高效管理资源，我们现在策划负责对接正式资源的上传 
        + 资源自提，鼓励项目成员对自己的工作负责
        + 三年以下开发经验的项目成员，提交东西需要 fast peer-review (个别可例外)
        + 每个组的负责人及核心成员有随时 rollback 本小组任何改动的权限
    - Unity中美术编辑大场景，非常慢很卡，有什么好的建议 
        + 如果场景超大而置之不顾，那对最终产品伤害远大于美术工作流程影响
        + 以区域为单位编辑，1. 以较低的频率集成到大场景 2. 方便随时改为动态加载
        + 关注热点区域 (hot region) 和可复用物件集 (reusable-prefab-set)
    - 对版本管理有什么好的经验与建议，我们使用GIT 
        + 如有可能，建议 Perforce/SVN, 游戏项目大部分是 Git 不友好的，麻烦远超好处
            * 二进制爆炸
            * 缺少目录级的粒度控制
            * 缺少权限控制
            * 策划和美术的培训成本
            * commit/pull/push 速度差太远
        + 程序员仍可以无缝用 git (Perforce Git Fusion)
            * [Git and P4: No Choice Required](https://www.perforce.com/blog/git-and-p4-no-choice-required) 
    - UI制作过程中美术、策划和程序具体是如何分工协作，我们是美术拼UI
        + 考虑 MVC 和数据驱动，M(策划 csv/lua) V(美术-prefab) C(程序 c#)
        + 注意培养性能意识 (纹理格式 / atlas 利用率 / 动画实现 / 材质量)
        + 不要让策划写逻辑，尽量把易变部分 table 化，lua 化，严控脚本层接口
        + 策划提的设计草图一定要给核心程序过一遍，性能问题提前把握和拦掉 (UI性能问题主要集中在特效及动画表现上)

2. 性能方向 
    - 在内存优化方面，如何分配好内存的使用，一般的原则是什么 
        + 美术重点关注贴图和动画 (前者注意格式，后者注意压缩)
        + 程序重点关注 C# Heap (都有明确的指标) String & Containers
        + 注意 C#/Lua 跨语言调用的开销
    - 资源分包策略，资源加载如何做到高效，我们现在是AB包的方式 
        + 缓存策略：内存和 IO 的折衷
        + 注意区分硬请求和软请求 (区分原则为用户是否感知和关注)
    - 如何应对手机发热(耗电量大)的问题 
        + 注意在合适的时候使用合适的帧率，避免 CPU/GPU 始终跑在完全负载上
        + 降帧：
            * 打开全屏 UI 面板 (如开启地图) 时
            * 聊天窗口激活时
            * 从战斗结束返回时
            * 等待网络回包时
            * 用户无动作，手机静置时
    - 大场景的实现方案，如何做分割加载，美术如何配合 
        + 多 Scene (引擎级) 不推荐
        + 手动 Prefab 级 - 自由灵活，高可控
        + 热点区域的拆分和独立维护 (必要的话可用简模)
        + [UQuadtree - 在 Unity 下实现场景资源的动态管理](http://gulu-dev.com/post/2015-07-11-uquadtree)

3. 渲染方向 
    - 灯光烘培方法和流程，实时光照的优化 
        + 如果用的是前向，注意控制任意时间点上活跃光源的数量和影响范围
    - SRP可编程渲染管线的应用与经验 
        + 期望了好久了，没在项目里用过，效果待验证
        + 很多用例，比如
            * 手动按重要程度排序
            * 可跳过(skippable)：物件级；pass级
            * 特定情况下使用简化材质 (角色渲染)
            * 特定情况下关闭后处理等流程
    - 顶点动画的应用与经验 
        + 只看下面一节课就够了：Technical Art Techniques of Naughty Dog: Vertex Shaders and Beyond
        + 在 GDCVault 内搜索 Naughty Dog
        + [GDC2017【神秘海域 4】中所使用的顶点着色器技术](http://gad.qq.com/article/detail/26248)

## 4. 热更新 

- 资源打包方式，热更新方案 
    + 资源热更 AB 追加，加载模块总是优先到更新包的路径内找资源 (也可以维护转接表)
    + 代码热更两个方案：腾讯 xlua & C# 反射热更 (总得来说不推荐)
- c#与Lua的分工是怎么的，如何避免更新底包 
    + 如果对热更的需求很强烈，要做好表现层 (C#) 和业务层 (Lua) 的隔离，这样 C# 层即使有问题也不会影响到逻辑，重要性达不到需要热更的程度
- c#与Lua的交互需要注意的地方 
    + 注意调用频繁的地方
    + 通过设计来批量化和最小化数据的传递
    + 要注意事件引起的栈上的递归 (跨语言消息传递异步化)
    + 不要不管不顾，什么都暴露给 Lua
        * 接口层本身会有巨大的查找和内存开销
        * 性能变得不可控 (无法直接通过 Profiler 等工具看到)

## 推荐阅读

- 顾煜 - [天涯明月刀幕后](https://zhuanlan.zhihu.com/p/36765725) 
- 顾露 
    + [Gu Lu's works and articles on Unity platform](https://github.com/mc-gulu/gl-bits/blob/master/gl-unity-collections.md)
    + [UQuadtree - 在 Unity 下实现场景资源的动态管理](http://gulu-dev.com/post/2015-07-11-uquadtree)
    + [Unity MemoryProfiler 的工作机制及可能的改进](http://gulu-dev.com/post/perf_assist/2017-01-25-unity-memoryprofiler)
    + [游戏引擎技术点滴](https://zhuanlan.zhihu.com/p/24927079) 的后半部分
    + [游戏开发汇总 (Gu Lu's Blog)](https://zhuanlan.zhihu.com/p/20289098)
- 其它
    + [GDC2017【神秘海域 4】中所使用的顶点着色器技术](http://gad.qq.com/article/detail/26248)
